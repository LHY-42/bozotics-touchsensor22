lightVal4 = 0
lightVal2 = 0
target = 0
threshold = 0
Speaker.Note(100,"C4",500)
Sensor.SetMode(1,4)
Sensor.SetMode(2,4)
Sensor.SetMode(3,0)
Sensor.SetMode(4,4)
Motor.StartSync("AB",100,100)
Program.Delay(2500)

Sub GyroPID
  gyroVal = Sensor.ReadRawValue(3,0)
  correction = gyroVal - target
EndSub

While threshold < 12 ''detect horiz black line
  target = 0
  GyroPID()
  rawVals4 = Sensor.ReadRaw(4,3)
  lightVal4 = (rawVals4[0]+rawVals4[1]+rawVals4[2])/3
  If lightVal4 < 25 Then
    threshold = threshold + 1
  EndIf
  If lightVal4 > 50 And threshold > -1 Then
    threshold = threshold - 1
  EndIf
  Motor.StartSync("AB",Math.Min(35+correction,100),Math.Max(35-correction,-100))
EndWhile
threshold = 0
Motor.Stop("AB","True")
Speaker.Note(100,"C4",500)
While gyroVal < 89 Or gyroVal > 91 ''wallbang
  target = 90
  GyroPID()
  Motor.StartSync("AB",Math.Min(0+correction,100),Math.Max(0-correction,-100))
EndWhile
Motor.MoveSync("AB",-100,-100,500,"True")
While threshold < 2 ''head to black line
  target = 60
  GyroPID()
  rawVals4 = Sensor.ReadRaw(4,3)
  lightVal4 = (rawVals4[0]+rawVals4[1]+rawVals4[2])/3
  If lightVal4 < 25 Then
    threshold = threshold + 1
  EndIf
  If lightVal4 > 50 And threshold > -1 Then
    threshold = threshold - 1
  EndIf
  Motor.StartSync("AB",Math.Min(35+correction,100),Math.Max(35-correction,-100))
EndWhile
threshold = 0
Motor.Stop("AB","True")
Motor.StartSync("AB",-100,-100)
Speaker.Note(100,"C4",500)
Program.Delay(160)
While threshold < 50
  target = 0
  GyroPID()
  If correction <> 0 Then
    threshold = threshold + 1
  EndIf
  If correction < -3 Or correction > 3 And threshold > -1 Then
    threshold = threshold - 1
  EndIf
  If threshold > 49 Then
    Program.Delay(10)
  EndIf
  Motor.StartSync("AB",Math.Min(0+correction,100),Math.Max(0-correction,-100))
EndWhile 
threshold = 0
Motor.Stop("AB","True")
Program.Delay(1000)
Program.End()
Motor.ResetCount("AB")
While "True" ''align for scan
  motorDiff = Motor.GetCount("A") - Motor.GetCount("B")
  rawVals2 = Sensor.ReadRaw(2,3)
  If rawVals2[0] < 5 And rawVals2[1] > 5 Then
    Speaker.Note(100,"C4",200)
  EndIf
  If rawVals2[0] > 40 And rawVals2[1] < 20 Then
    Speaker.Note(100,"D4",200)
  EndIf
  If rawVals2[0] > 40 And rawVals2[1] > 25 Then
    Speaker.Note(100,"E4",200)
  EndIf
  Motor.StartSync("AB",Math.Max(15-motorDiff,-100),Math.Min(15+motorDiff,100))
EndWhile